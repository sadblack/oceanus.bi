(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-213b07f9"],{1445:function(t,e,r){},"46e3":function(t,e,r){"use strict";r.r(e);var a=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"container"},[r("el-card",{staticClass:"dashboard-list",attrs:{"body-style":"padding: 0px;",shadow:"never"}},[r("div",{attrs:{slot:"header"},slot:"header"},[r("span",[t._v(t._s(t.$t("reportcenter.title")))]),0==t.isShare?r("i",{staticClass:"el-icon-edit",attrs:{size:"small"},on:{click:t.editReport}}):t._e(),0==t.isShare?r("i",{staticClass:"el-icon-delete",attrs:{size:"small"},on:{click:t.deleteReport}}):t._e()]),r("el-tabs",{model:{value:t.activeName,callback:function(e){t.activeName=e},expression:"activeName"}},[r("el-tab-pane",{key:"first",attrs:{label:"公共报表",name:"first"}},[r("div",{staticClass:"head-container"},[r("el-tree",{ref:"tree",attrs:{data:t.publicTreeOptions,props:t.defaultProps,"expand-on-click-node":!1,"default-expand-all":""},on:{"node-click":t.handleNodeClick}})],1)]),r("el-tab-pane",{key:"second",attrs:{label:"我的报表",name:"second"}},[r("div",{staticClass:"head-container"},[r("el-tree",{ref:"tree",attrs:{data:t.myTreeOptions,props:t.defaultProps,"expand-on-click-node":!1,"default-expand-all":""},on:{"node-click":t.handleNodeClick}})],1)])],1)],1),r("div",{staticClass:"dashboard-wrapper"},[r("div",{staticClass:"tool-bar"},[r("div",[r("span",{staticClass:"db-name"},[t._v(t._s(t.report_name))]),r("span",[t._v(t._s(t.report_desc))])]),r("div",{directives:[{name:"show",rawName:"v-show",value:0==t.isShare,expression:"isShare == false"}]},[r("el-button",{attrs:{type:"primary",size:"mini"},on:{click:t.handleShare}},[t._v(t._s(t.$t("common.share")))]),r("el-button",{attrs:{type:"primary",size:"mini"},on:{click:t.handleDownload}},[t._v(t._s(t.$t("common.export")))])],1)]),r("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.reportloading,expression:"reportloading"}],attrs:{data:t.tables}},[r("el-table-column",{attrs:{type:"selection"}}),r("el-table-column",{attrs:{label:"序号",type:"index"}}),t._l(t.tableData,(function(t){return[r("el-table-column",{key:t.dataItem,attrs:{sortable:"","show-overflow-tooltip":!0,prop:t.dataItem,label:t.dataName}})]}))],2),r("pagination",{directives:[{name:"show",rawName:"v-show",value:t.total>0,expression:"total>0"}],attrs:{total:t.total,page:t.queryParams.pageNum,limit:t.queryParams.pageSize},on:{"update:page":function(e){return t.$set(t.queryParams,"pageNum",e)},"update:limit":function(e){return t.$set(t.queryParams,"pageSize",e)},pagination:t.getList}})],1),r("el-dialog",{attrs:{title:t.sharetitle,visible:t.shareopen,"append-to-body":""},on:{"update:visible":function(e){t.shareopen=e}}},[r("el-form",{ref:"shareform",attrs:{model:t.shareform,"label-width":"120px"}},[r("el-form-item",{attrs:{label:"选择人员",prop:"userids"}},[r("el-select",{attrs:{multiple:"","collapse-tags":"",placeholder:"请选择要分享的人员"},model:{value:t.shareform.userids,callback:function(e){t.$set(t.shareform,"userids",e)},expression:"shareform.userids"}},t._l(t.useroptions,(function(t){return r("el-option",{key:t.userId,attrs:{label:t.nickName,value:t.userId}})})),1)],1)],1),r("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{attrs:{type:"primary"},on:{click:t.submitShareForm}},[t._v("确 定")]),r("el-button",{on:{click:t.sharecancel}},[t._v("取 消")])],1)],1)],1)},n=[],o=(r("28a5"),r("d01e")),i=r("5fd4"),s=r("ca17"),c=r.n(s),u=(r("542c"),r("ed08")),d={name:"reportcenter",components:{Treeselect:c.a},data:function(){return{activeName:"second",reportList:[],publicTreeOptions:void 0,myTreeOptions:void 0,currentReport:void 0,report_name:void 0,report_desc:void 0,loading:!0,isCollapse:!1,tableloading:!0,isShare:!1,defaultProps:{children:"children",label:"label"},tables:null,tableData:null,shareopen:!1,useroptions:[],sharetitle:"",shareform:[],reportloading:!0,total:0,queryParams:{pageNum:1,pageSize:100,source_id:void 0,report_id:void 0}}},created:function(){this.publicReportList(),this.myReportList()},watch:{"currentReport.report_id":{immediate:!0,handler:function(t){t&&(this.report_name=this.currentReport.report_name,this.report_desc=this.currentReport.report_desc,this.queryParams.source_id=this.currentReport.source_id,this.queryParams.report_id=this.currentReport.report_id,this.getList())}}},methods:{sharecancel:function(){this.shareopen=!1,this.reset()},reset:function(){this.shareform={userids:void 0,report_id:void 0},this.resetForm("shareform")},handleShare:function(){var t=this;Object(i["h"])(this.queryParams).then((function(e){t.useroptions=e.rows})),this.reset(),this.shareopen=!0,this.sharetitle="数据报告分享",this.shareform.dashboard_id=this.dashboard.dashboard_id},submitShareForm:function(){var t=this,e=this.shareform.userids.join(",");if(this.shareform.userids=e,this.shareform.report_id=this.currentReport.report_id,void 0==this.currentReport.report_id||""==e)return this.msgError("分享失败"),void(this.shareopen=!1);Object(o["k"])(this.shareform).then((function(e){200===e.code&&(t.msgSuccess("分享成功"),t.shareopen=!1)}))},publicReportList:function(){var t=this;this.loading=!0,Object(o["h"])().then((function(e){t.publicTreeOptions=e.data,t.loading=!1}))},myReportList:function(){var t=this;this.loading=!0,Object(o["g"])().then((function(e){t.myTreeOptions=e.data,t.loading=!1,t.reportList=e.data[0].children;var r=t.reportList[0];t.currentReport=r||t.reportList[0],Object(o["c"])(t.currentReport.id).then((function(e){t.currentReport=e.data})),t.currentReport&&(t.report_name=t.currentReport.report_name,t.report_desc=t.currentReport.report_desc,t.$router.push("/reportcenter?id=".concat(t.currentReport.id)))}))},handleNodeClick:function(t){var e=this;t.id;1==t.isChild&&(t.isShare?this.isShare=!0:this.isShare=!1,Object(o["c"])(t.id).then((function(t){e.currentReport=t.data})),this.report_name=this.currentReport.report_name,this.report_desc=this.currentReport.report_desc,this.$router.push("/reportcenter?id=".concat(this.currentReport.report_id)))},getList:function(){var t=this;this.reportloading=!0,Object(o["j"])(this.queryParams).then((function(e){t.tables=e.rows,t.tableData=e.headers,t.total=e.total,t.reportloading=!1})).catch((function(t){console.log(t),this.reportloading=!1}))},handleDownload:function(){var t=this;Promise.all([r.e("chunk-41515614"),r.e("chunk-58293907")]).then(r.bind(null,"4bf8d")).then((function(e){var r=t.tableData.map((function(t){return t.dataItem})),a=t.tableData.map((function(t){return t.dataName})),n=r,o=t.formatJson(n,t.tables);e.export_json_to_excel({header:a,data:o,filename:"DataExport"+Object(u["b"])(Date.now(),"{m}{d}{h}{i}{s}"),autoWidth:!0})}))},formatJson:function(t,e){return e.map((function(e){return t.map((function(t){var r=t.split(".");return r.length<=1?e[t]:r.reduce((function(t,e){return t[e]?t[e]:"--"}),e)}))}))},editReport:function(t){var e=this.currentReport.id||this.currentReport.report_id;this.$router.push("/sqlconsole/".concat(e))},handleCommand:function(t){"edit"===t.type?this.editReport(t.target):this.deleteReport(t.target)},deleteReport:function(){var t=this;this.$confirm("确定要删除["+this.currentReport.report_name+"]报表吗？将同时删除该该报表的分享","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){var e=t.currentReport.id||t.currentReport.report_id;Object(o["b"])(e).then((function(){t.$message({type:"success",message:t.$t("common.deleteSuccess")}),t.myReportList(),t.publicReportList()}))}))}}},l=d,p=(r("5a4e"),r("2877")),h=Object(p["a"])(l,a,n,!1,null,"11e576e0",null);e["default"]=h.exports},"5a4e":function(t,e,r){"use strict";r("1445")},"5fd4":function(t,e,r){"use strict";r.d(e,"b",(function(){return n})),r.d(e,"n",(function(){return o})),r.d(e,"i",(function(){return i})),r.d(e,"g",(function(){return s})),r.d(e,"d",(function(){return c})),r.d(e,"a",(function(){return u})),r.d(e,"c",(function(){return d})),r.d(e,"e",(function(){return l})),r.d(e,"m",(function(){return p})),r.d(e,"f",(function(){return h})),r.d(e,"k",(function(){return m})),r.d(e,"j",(function(){return f})),r.d(e,"h",(function(){return b})),r.d(e,"l",(function(){return v}));var a=r("b775");function n(t){return Object(a["a"])({url:"/rest/bi/dashboard/create",method:"POST",data:t})}function o(t){return Object(a["a"])({url:"/rest/bi/dashboard/update",method:"put",data:t})}function i(t){return Object(a["a"])({url:"/rest/bi/dashboard/query/".concat(t)})}function s(t){return Object(a["a"])({url:"/rest/bi/dashboard/delete",method:"delete",params:t})}function c(t){return Object(a["a"])({url:"/rest/bi/dashboard/list/".concat(t)})}function u(t){return Object(a["a"])({url:"/rest/bi/dashboard/map",method:"get",params:t})}function d(t){return Object(a["a"])({url:"/rest/bi/dashboard/chartByDashboard/".concat(t)})}function l(t){return Object(a["a"])({url:"/rest/bi/dashboard/boardbychart?chartId=".concat(t)})}function p(t){return Object(a["a"])({url:"/rest/bi/dashboard/unmap",method:"get",params:t})}function h(t){return Object(a["a"])({url:"/rest/bi/dashboard/order",method:"POST",data:t})}function m(t){return Object(a["a"])({url:"/rest/bi/dashboard/publictree/".concat(t)})}function f(t){return Object(a["a"])({url:"/rest/bi/dashboard/mytree/".concat(t)})}function b(){return Object(a["a"])({url:"/rest/share/list"})}function v(t){return Object(a["a"])({url:"/rest/share/add",method:"get",params:t})}},d01e:function(t,e,r){"use strict";r.d(e,"f",(function(){return n})),r.d(e,"b",(function(){return o})),r.d(e,"j",(function(){return i})),r.d(e,"e",(function(){return s})),r.d(e,"d",(function(){return c})),r.d(e,"l",(function(){return u})),r.d(e,"a",(function(){return d})),r.d(e,"c",(function(){return l})),r.d(e,"h",(function(){return p})),r.d(e,"g",(function(){return h})),r.d(e,"k",(function(){return m})),r.d(e,"i",(function(){return f}));var a=r("b775");function n(t){return Object(a["a"])({url:"/rest/report/sql_exec",method:"post",data:t})}function o(t){return Object(a["a"])({url:"/rest/report/remove/".concat(t),method:"delete"})}function i(t){return Object(a["a"])({url:"/rest/report/reportresult",method:"get",params:t})}function s(){return Object(a["a"])({url:"/rest/bi/datasource/list",method:"get"})}function c(t){return Object(a["a"])({url:"/rest/bi/datasource/tabletree/"+t,method:"get"})}function u(t){return Object(a["a"])({url:"/rest/report/update",method:"put",data:t})}function d(t){return Object(a["a"])({url:"/rest/report/create",method:"post",data:t})}function l(t){return Object(a["a"])({url:"/rest/report/query/"+t,method:"get"})}function p(){return Object(a["a"])({url:"/rest/report/publictree"})}function h(){return Object(a["a"])({url:"/rest/report/myreporttree/"})}function m(t){return Object(a["a"])({url:"/rest/report/share",method:"get",params:t})}function f(t){return Object(a["a"])({url:"/rest/report/list",method:"get",params:t})}}}]);