(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3e821abc"],{"1cee":function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"app-container"},[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:5,xs:24}},[a("div",{staticClass:"head-container"},[a("el-input",{staticStyle:{"margin-bottom":"20px"},attrs:{placeholder:"请输入Table Name",clearable:"",size:"small","prefix-icon":"el-icon-search"},model:{value:t.tableName,callback:function(e){t.tableName=e},expression:"tableName"}})],1),a("div",{staticClass:"head-container"},[a("el-tree",{ref:"tree",attrs:{data:t.tableTreeOptions,props:t.defaultProps,"expand-on-click-node":!1,"filter-node-method":t.filterNode,"default-expand-all":""},on:{"node-click":t.handleNodeClick}})],1)]),a("el-col",{attrs:{span:19,xs:24}},[a("el-button",{attrs:{type:"primary",icon:"el-icon-check",size:"small"},on:{click:t.saveFieldAlase}},[t._v(t._s(t.$t("common.saveData")))]),a("el-button",{attrs:{type:"primary",icon:"el-icon-plus",size:"small"},on:{click:t.addtable}},[t._v(t._s(t.$t("common.addtable")))]),a("el-button",{attrs:{type:"info",icon:"el-icon-upload2",size:"small"},on:{click:t.handleImport}},[t._v(t._s(t.$t("common.importtable")))]),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"tb-edit",staticStyle:{width:"100%"},attrs:{data:t.fieldList,"highlight-current-row":""}},[a("el-table-column",{attrs:{type:"selection",width:"50",align:"center"}}),a("el-table-column",{attrs:{label:"字段中文名称",sortable:"",align:"center",prop:"field_cname",width:"140"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-input",{attrs:{size:"mini",placeholder:""},model:{value:e.row.field_cname,callback:function(a){t.$set(e.row,"field_cname",a)},expression:"scope.row.field_cname"}})]}}])}),a("el-table-column",{attrs:{label:"字段名称",sortable:"",align:"center",prop:"field_name"}}),a("el-table-column",{attrs:{label:"字段类型",sortable:"",align:"center",prop:"field_type"}}),a("el-table-column",{attrs:{label:"是否为空",sortable:"",align:"center",prop:"is_empty",formatter:t.statusFormat}}),a("el-table-column",{attrs:{label:"字段长度",sortable:"",align:"center",prop:"field_lenght",width:"120"}})],1),a("pagination",{directives:[{name:"show",rawName:"v-show",value:t.total>0,expression:"total>0"}],attrs:{total:t.total,page:t.queryParams.pageNum,limit:t.queryParams.pageSize},on:{"update:page":function(e){return t.$set(t.queryParams,"pageNum",e)},"update:limit":function(e){return t.$set(t.queryParams,"pageSize",e)},pagination:t.getList}})],1)],1),a("el-dialog",{attrs:{title:t.title,visible:t.tableopen,width:"450px","append-to-body":""},on:{"update:visible":function(e){t.tableopen=e}}},[a("el-form",{ref:"tableform",attrs:{model:t.tableform,rules:t.tablerules,"label-width":"120px"}},[a("el-row",[a("el-col",[a("el-form-item",{attrs:{label:"表中文名称",prop:"table_alias"}},[a("el-input",{attrs:{placeholder:"表中文名称"},model:{value:t.tableform.table_alias,callback:function(e){t.$set(t.tableform,"table_alias",e)},expression:"tableform.table_alias"}})],1)],1)],1),a("el-row",[a("el-col",[a("el-form-item",{attrs:{label:"表名",prop:"table_name"}},[a("el-input",{attrs:{placeholder:"表名"},model:{value:t.tableform.table_name,callback:function(e){t.$set(t.tableform,"table_name",e)},expression:"tableform.table_name"}})],1)],1)],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},on:{click:t.tablesubmitForm}},[t._v("确 定")]),a("el-button",{on:{click:t.tablecancel}},[t._v("取 消")])],1)],1),a("el-dialog",{attrs:{title:t.upload.title,visible:t.upload.open,width:"400px","append-to-body":""},on:{"update:visible":function(e){return t.$set(t.upload,"open",e)}}},[a("el-upload",{ref:"upload",attrs:{limit:1,accept:".xlsx, .xls",headers:t.upload.headers,action:t.upload.url+"?table_id="+this.upload.table_id,disabled:t.upload.isUploading,"on-progress":t.handleFileUploadProgress,"on-success":t.handleFileSuccess,"auto-upload":!1,drag:""}},[a("i",{staticClass:"el-icon-upload"}),a("div",{staticClass:"el-upload__text"},[t._v("\n        将文件拖到此处，或\n        "),a("em",[t._v("点击上传")])]),a("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[a("el-link",{staticStyle:{"font-size":"12px"},attrs:{type:"info"},on:{click:t.importTemplate}},[t._v("下载模板")])],1),a("div",{staticClass:"el-upload__tip",staticStyle:{color:"red"},attrs:{slot:"tip"},slot:"tip"},[t._v("提示：仅允许导入“xls”或“xlsx”格式文件！")])]),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},on:{click:t.submitFileForm}},[t._v("确 定")]),a("el-button",{on:{click:function(e){t.upload.open=!1}}},[t._v("取 消")])],1)],1)],1)},l=[],o=a("5f87"),n=a("b414"),r=a("ca17"),s=a.n(r),d=(a("542c"),{name:"metadata",components:{Treeselect:s.a},data:function(){return{loading:!1,ids:[],single:!0,multiple:!0,title:"",total:0,tableTreeOptions:void 0,table_id:void 0,open:!1,is_empty_options:[],field_type_options:[],tableName:void 0,dateRange:[],fieldList:[],dsid:void 0,form:{},importform:{},defaultProps:{children:"children",label:"label"},queryParams:{pageNum:1,pageSize:50,table_id:void 0,table_name:void 0,dsid:void 0,table_alias:void 0},upload:{open:!1,title:"",isUploading:!1,table_id:0,headers:{Authorization:"Bearer "+Object(o["a"])()},url:"/prod/rest/bi/meta/importField"},tableform:{},tableopen:!1,tablerules:{table_name:[{required:!0,message:"表名不能为空",trigger:"blur"}],table_alias:[{required:!0,message:"表中文不能为空",trigger:"blur"}]}}},created:function(){var t=this;this.getDicts("field_is_empty").then((function(e){t.is_empty_options=e.data})),this.getDicts("rule_field_type").then((function(e){t.field_type_options=e.data})),this.getTreeselect()},methods:{handleImport:function(){this.upload.title="表字段导入",void 0!=this.upload.table_id?this.upload.open=!0:this.msgError("请选择左侧数据源下的表,然后倒入字段")},importTemplate:function(){var t=this;Object(n["h"])().then((function(e){t.download(e.msg)}))},handleFileUploadProgress:function(t,e,a){this.upload.isUploading=!0},handleFileSuccess:function(t,e,a){this.upload.open=!1,this.upload.isUploading=!1,this.$refs.upload.clearFiles(),this.$alert(t.msg,"导入结果",{dangerouslyUseHTMLString:!0}),this.getList()},submitFileForm:function(){this.$refs.upload.submit()},addtable:function(){void 0!=this.dsid?(this.tableform={table_name:void 0,table_alias:void 0,source_id:this.dsid},this.resetForm("tableform"),this.tableopen=!0,this.title="添加表"):this.msgError("请选择左侧数据源,然后添加表")},tablecancel:function(){this.tableopen=!1,this.tableform.table_name=void 0,this.tableform.table_alias=void 0,this.tableform.source_id=void 0,this.resetForm("tableform")},tablesubmitForm:function(){var t=this,e=this.dsid;this.$refs["tableform"].validate((function(a){a&&(void 0!=e?t.$confirm("你确认要添加表吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消"}).then((function(e){e.value;Object(n["b"])(t.addDateRange(t.tableform)).then((function(e){200===e.code&&(t.msgSuccess("表添加成功"),t.tableopen=!1,t.getTreeselect())}))})):t.msgError("请选择左侧选择数据源,然后添加表"))}))},saveFieldAlase:function(){var t=this,e=this.fieldList.map((function(t){return t}));Object(n["j"])(e).then((function(e){t.showTableDialog=!1,t.msgSuccess("保存成功")})).catch((function(){}))},getList:function(){var t=this;this.loading=!0,Object(n["g"])(this.queryParams).then((function(e){t.fieldList=e.rows,t.total=e.total,t.loading=!1}))},statusFormat:function(t,e){return this.selectDictLabel(this.is_empty_options,t.is_empty)},fieldTypeFormat:function(t,e){return this.selectDictLabel(this.field_type_options,t.field_type)},getTreeselect:function(){var t=this;Object(n["m"])().then((function(e){t.tableTreeOptions=e.data}))},filterNode:function(t,e){return!t||-1!==e.label.indexOf(t)},handleNodeClick:function(t){var e=t.tableName;void 0!=t.dbtype&&(this.dsid=t.id,this.queryParams.dsid=t.id),void 0!=e&&(this.table_id=t.is,this.queryParams.table_id=t.id,this.upload.table_id=t.id,this.getList())}}}),c=d,u=(a("fdc7"),a("2877")),p=Object(u["a"])(c,i,l,!1,null,"668e2cef",null);e["default"]=p.exports},b414:function(t,e,a){"use strict";a.d(e,"k",(function(){return o})),a.d(e,"a",(function(){return n})),a.d(e,"e",(function(){return r})),a.d(e,"n",(function(){return s})),a.d(e,"c",(function(){return d})),a.d(e,"d",(function(){return c})),a.d(e,"m",(function(){return u})),a.d(e,"f",(function(){return p})),a.d(e,"g",(function(){return b})),a.d(e,"l",(function(){return m})),a.d(e,"i",(function(){return f})),a.d(e,"j",(function(){return h})),a.d(e,"b",(function(){return g})),a.d(e,"h",(function(){return _}));var i=a("b775"),l=a("a0ce");function o(t){return Object(i["a"])({url:"/rest/bi/datasource/sync/"+Object(l["d"])(t),method:"get"})}function n(t){return Object(i["a"])({url:"/rest/bi/datasource/add",method:"post",data:t})}function r(t){return Object(i["a"])({url:"/rest/bi/datasource/list",method:"get",params:t})}function s(t){return Object(i["a"])({url:"/rest/bi/datasource/edit",method:"put",data:t})}function d(t){return Object(i["a"])({url:"/rest/bi/datasource/delete/"+Object(l["d"])(t),method:"delete"})}function c(t){return Object(i["a"])({url:"/rest/bi/datasource/query/"+Object(l["d"])(t),method:"get"})}function u(){return Object(i["a"])({url:"/rest/bi/datasource/metatree",method:"get"})}function p(t){return Object(i["a"])({url:"/rest/bi/datasource/fields",method:"get",params:t})}function b(t){return Object(i["a"])({url:"/rest/bi/datasource/fieldsById",method:"get",params:t})}function m(t){return Object(i["a"])({url:"/rest/bi/datasource/getTable/"+Object(l["d"])(t),method:"get"})}function f(t){return Object(i["a"])({url:"/rest/bi/datasource/saveTableConfig",method:"POST",data:t})}function h(t){return Object(i["a"])({url:"/rest/bi/meta/saveTableFieldConfig",method:"POST",data:t})}function g(t){return Object(i["a"])({url:"/rest/bi/meta/addtable",method:"POST",data:t})}function _(){return Object(i["a"])({url:"/rest/bi/meta/dowloadTemplate",method:"get"})}},d2e8:function(t,e,a){},fdc7:function(t,e,a){"use strict";a("d2e8")}}]);