(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-71fda5e9","chunk-614a2346"],{"29b9":function(t,e,a){},"2dec":function(t,e,a){"use strict";a("e2636")},5324:function(t,e,a){"use strict";a("b151")},"5fd4":function(t,e,a){"use strict";a.d(e,"b",(function(){return r})),a.d(e,"n",(function(){return i})),a.d(e,"i",(function(){return o})),a.d(e,"g",(function(){return s})),a.d(e,"d",(function(){return c})),a.d(e,"a",(function(){return d})),a.d(e,"c",(function(){return l})),a.d(e,"e",(function(){return u})),a.d(e,"m",(function(){return h})),a.d(e,"f",(function(){return m})),a.d(e,"k",(function(){return f})),a.d(e,"j",(function(){return p})),a.d(e,"h",(function(){return b})),a.d(e,"l",(function(){return g}));var n=a("b775");function r(t){return Object(n["a"])({url:"/rest/bi/dashboard/create",method:"POST",data:t})}function i(t){return Object(n["a"])({url:"/rest/bi/dashboard/update",method:"put",data:t})}function o(t){return Object(n["a"])({url:"/rest/bi/dashboard/query/".concat(t)})}function s(t){return Object(n["a"])({url:"/rest/bi/dashboard/delete",method:"delete",params:t})}function c(t){return Object(n["a"])({url:"/rest/bi/dashboard/list/".concat(t)})}function d(t){return Object(n["a"])({url:"/rest/bi/dashboard/map",method:"get",params:t})}function l(t){return Object(n["a"])({url:"/rest/bi/dashboard/chartByDashboard/".concat(t)})}function u(t){return Object(n["a"])({url:"/rest/bi/dashboard/boardbychart?chartId=".concat(t)})}function h(t){return Object(n["a"])({url:"/rest/bi/dashboard/unmap",method:"get",params:t})}function m(t){return Object(n["a"])({url:"/rest/bi/dashboard/order",method:"POST",data:t})}function f(t){return Object(n["a"])({url:"/rest/bi/dashboard/publictree/".concat(t)})}function p(t){return Object(n["a"])({url:"/rest/bi/dashboard/mytree/".concat(t)})}function b(){return Object(n["a"])({url:"/rest/share/list"})}function g(t){return Object(n["a"])({url:"/rest/share/add",method:"get",params:t})}},"6b47":function(t,e,a){},8034:function(t,e,a){"use strict";a("6b47")},"943b":function(t,e,a){"use strict";a("29b9")},a5e0:function(t,e,a){"use strict";a.d(e,"c",(function(){return r})),a.d(e,"b",(function(){return i})),a.d(e,"a",(function(){return o}));a("a481"),a("28a5"),a("7f7f"),a("7514");var n=a("aa35");function r(t){var e;return e=t.indexOf("(")>=0?n["a"].find((function(e){return e.name===t.split("(")[0]})):n["a"].find((function(e){return e.name===t})),e}function i(t){var e,a,n,i=t.dataSrc,o=t.selectedCalcul,s=t.selectedDimension,c=t.orderByStrs,d=t.filterStr,l=t.limit,u=[],h=[],m=[];if(m=m.concat(o).concat(s),u=m.map((function(t){var e=o.find((function(e){return e.Column===t.Column}));return e&&"none"!==e.calculFunc?"distinct"==e.calculFunc?"count(distinct ".concat(e.Column,") as ").concat(e.Column):"".concat(e.calculFunc||r(e.Type).availableFunc[0],"(").concat(e.Column,") as ").concat(e.Column):(h.push(t.Column),t.Column)})),0!==u.length&&i)return h.length>0&&(e="GROUP BY ".concat(h.join())),c.length>0&&(a="ORDER BY ".concat(c.join())),d&&(d=d.replace(/>/g,"&lt;"),d=d.replace(/</g,"&gt;"),n="where ".concat(d)),"SELECT ".concat(u.join()," FROM ").concat(i," ").concat(n||""," ").concat(e||""," ").concat(a||""," LIMIT ").concat(l||200)}function o(t){var e,a=t.value;return r(t.colType).needQuotation&&(a=n(t.value,t)),e=1===t.operatorParamNum?"".concat(t.filteCol," ").concat(t.filterOperator," ").concat(a.value1):2===t.operatorParamNum?"".concat(t.filteCol," ").concat(t.filterOperator," ").concat(a.value1," and ").concat(a.value2):"".concat(t.filteCol," ").concat(t.filterOperator," ('").concat(a.arrValue.join(","),"')"),e;function n(t,e){var a=e.colType;return"varchar"!=a&&"varchar2"!=a&&"tinytext"!=a&&"text"!=a&&"mediumtext"!=a&&"longtext"!=a?{value1:"".concat(t.value1),value2:"".concat(t.value2),arrValue:t.arrValue.map((function(t){return"".concat(t)}))}:{value1:"'".concat(t.value1,"'"),value2:"'".concat(t.value2,"'"),arrValue:t.arrValue.map((function(t){return"'".concat(t,"'")}))}}}},aa35:function(t,e,a){"use strict";a.d(e,"c",(function(){return i})),a.d(e,"b",(function(){return s})),a.d(e,"a",(function(){return c}));a("7f7f");var n=a("5530"),r=a("9225"),i={sum:r["a"].t("config.sum"),avg:r["a"].t("config.avg"),max:r["a"].t("config.max"),min:r["a"].t("config.min"),count:r["a"].t("config.count"),distinct:r["a"].t("config.distinct"),none:r["a"].t("config.none")},o=[{operator:"=",name:"config.is",paramNum:1},{operator:">",name:"config.greater",paramNum:1},{operator:"<",name:"config.less",paramNum:1},{operator:">=",name:"config.greaterOrEqual",paramNum:1},{operator:"<=",name:"config.lessorEqual",paramNum:1},{operator:"!=",name:"config.isNot",paramNum:1},{operator:"BETWEEN",name:"config.between",paramNum:2},{operator:"IN",name:"config.in",paramNum:-1},{operator:"LIKE",name:"config.like",paramNum:1}];function s(){return o.map((function(t){var e=Object(n["a"])({},t);return e.name=r["a"].t(t.name),e}))}var c=[{name:"tinyint",needQuotation:!1,availableFunc:["sum","avg","max","min","count","none","distinct"]},{name:"smallint",needQuotation:!1,availableFunc:["sum","avg","max","min","count","none"]},{name:"mediumint",needQuotation:!1,availableFunc:["sum","avg","max","min","count","none"]},{name:"int",needQuotation:!1,availableFunc:["sum","avg","max","min","count","none","distinct"]},{name:"bigint",needQuotation:!1,availableFunc:["sum","avg","max","min","count","none"]},{name:"float",needQuotation:!1,availableFunc:["sum","avg","max","min","count","none"]},{name:"double",needQuotation:!1,availableFunc:["sum","avg","max","min","count","none"]},{name:"real",needQuotation:!1,availableFunc:["sum","avg","max","min","count","none"]},{name:"decimal",needQuotation:!1,availableFunc:["sum","avg","max","min","count","none"]},{name:"timestamp",needQuotation:!1,availableFunc:["count","none","distinct"]},{name:"date",needQuotation:!0,availableFunc:["count","none","distinct"]},{name:"time",needQuotation:!0,availableFunc:["count","none","distinct"]},{name:"datetime",needQuotation:!0,availableFunc:["count","none","distinct"]},{name:"year",needQuotation:!0,availableFunc:["count","none","distinct"]},{name:"char",needQuotation:!0,availableFunc:["count","none","distinct"]},{name:"varchar",needQuotation:!0,availableFunc:["count","none","distinct"]},{name:"varchar2",needQuotation:!0,availableFunc:["count","none","distinct"]},{name:"tinytext",needQuotation:!0,availableFunc:["count","none","distinct"]},{name:"text",needQuotation:!0,availableFunc:["count","none","distinct"]},{name:"mediumtext",needQuotation:!0,availableFunc:["count","none","distinct"]},{name:"longtext",needQuotation:!0,availableFunc:["count","none","distinct"]},{name:"integer",needQuotation:!1,availableFunc:["sum","avg","max","min","count","none"]}]},b151:function(t,e,a){},b414:function(t,e,a){"use strict";a.d(e,"k",(function(){return i})),a.d(e,"a",(function(){return o})),a.d(e,"e",(function(){return s})),a.d(e,"n",(function(){return c})),a.d(e,"c",(function(){return d})),a.d(e,"d",(function(){return l})),a.d(e,"m",(function(){return u})),a.d(e,"f",(function(){return h})),a.d(e,"g",(function(){return m})),a.d(e,"l",(function(){return f})),a.d(e,"i",(function(){return p})),a.d(e,"j",(function(){return b})),a.d(e,"b",(function(){return g})),a.d(e,"h",(function(){return y}));var n=a("b775"),r=a("a0ce");function i(t){return Object(n["a"])({url:"/rest/bi/datasource/sync/"+Object(r["d"])(t),method:"get"})}function o(t){return Object(n["a"])({url:"/rest/bi/datasource/add",method:"post",data:t})}function s(t){return Object(n["a"])({url:"/rest/bi/datasource/list",method:"get",params:t})}function c(t){return Object(n["a"])({url:"/rest/bi/datasource/edit",method:"put",data:t})}function d(t){return Object(n["a"])({url:"/rest/bi/datasource/delete/"+Object(r["d"])(t),method:"delete"})}function l(t){return Object(n["a"])({url:"/rest/bi/datasource/query/"+Object(r["d"])(t),method:"get"})}function u(){return Object(n["a"])({url:"/rest/bi/datasource/metatree",method:"get"})}function h(t){return Object(n["a"])({url:"/rest/bi/datasource/fields",method:"get",params:t})}function m(t){return Object(n["a"])({url:"/rest/bi/datasource/fieldsById",method:"get",params:t})}function f(t){return Object(n["a"])({url:"/rest/bi/datasource/getTable/"+Object(r["d"])(t),method:"get"})}function p(t){return Object(n["a"])({url:"/rest/bi/datasource/saveTableConfig",method:"POST",data:t})}function b(t){return Object(n["a"])({url:"/rest/bi/meta/saveTableFieldConfig",method:"POST",data:t})}function g(t){return Object(n["a"])({url:"/rest/bi/meta/addtable",method:"POST",data:t})}function y(){return Object(n["a"])({url:"/rest/bi/meta/dowloadTemplate",method:"get"})}},bdaf:function(t,e,a){},c638:function(t,e,a){"use strict";a.d(e,"b",(function(){return r})),a.d(e,"e",(function(){return i})),a.d(e,"d",(function(){return o})),a.d(e,"c",(function(){return s})),a.d(e,"a",(function(){return c}));var n=a("b775");function r(t){return Object(n["a"])({url:"/rest/bi/chart/create",method:"POST",data:t})}function i(t){return Object(n["a"])({url:"/rest/bi/chart/update",method:"PUT",data:t})}function o(t){return Object(n["a"])({url:"/rest/bi/chart/tables/".concat(t)})}function s(t){return Object(n["a"])({url:"/rest/bi/chart/delete",method:"delete",params:t})}function c(t){return Object(n["a"])({url:"/rest/bi/chart/list",method:"get",params:t})}},c937:function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"container"},[a("el-card",{staticClass:"dashboard-list",attrs:{"body-style":"padding: 0px;",shadow:"never"}},[a("div",{attrs:{slot:"header"},slot:"header"},[a("span",[t._v(t._s(t.$t("common.dashboard")))]),a("i",{staticClass:"el-icon-plus",attrs:{size:"small"},on:{click:t.addDashboard}}),0==t.isShare?a("i",{staticClass:"el-icon-edit",attrs:{size:"small"},on:{click:t.editDashboard}}):t._e(),0==t.isShare?a("i",{staticClass:"el-icon-delete",attrs:{size:"small"},on:{click:t.deleteDashboard}}):t._e()]),a("el-tabs",{model:{value:t.activeName,callback:function(e){t.activeName=e},expression:"activeName"}},[a("el-tab-pane",{key:"first",attrs:{label:"公共概览",name:"first"}},[a("div",{staticClass:"head-container"},[a("el-tree",{ref:"tree",attrs:{data:t.publicTreeOptions,props:t.defaultProps,"expand-on-click-node":!1,"default-expand-all":""},on:{"node-click":t.handleNodeClick}})],1)]),a("el-tab-pane",{key:"second",attrs:{label:"我的概览",name:"second"}},[a("div",{staticClass:"head-container"},[a("el-tree",{ref:"tree",attrs:{data:t.myTreeOptions,props:t.defaultProps,"expand-on-click-node":!1,"default-expand-all":""},on:{"node-click":t.handleNodeClick}})],1)])],1)],1),0==t.isShare?a("div",{staticClass:"dashboard-wrapper"},[a("dashboardItem",{attrs:{dashboard:t.currentDashboard,mode:"edit"}})],1):a("div",{staticClass:"dashboard-wrapper"},[a("dashboardItem",{attrs:{dashboard:t.currentDashboard,mode:"view"}})],1),a("el-dialog",{attrs:{title:t.$t("dashboard.addOrEditDashboard"),width:"750px",visible:t.editDialogVisible},on:{"update:visible":function(e){t.editDialogVisible=e}}},[a("el-form",{ref:"dbObj",attrs:{model:t.dbObj,rules:t.rules,"label-width":"120px"}},[a("el-row",[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:t.$t("dashboard.dashboardName"),prop:"dashborad_name"}},[a("el-input",{staticStyle:{width:"450px"},attrs:{size:"small",placeholder:t.$t("dashboard.dashboardNamePlaceholder")},model:{value:t.dbObj.dashborad_name,callback:function(e){t.$set(t.dbObj,"dashborad_name",e)},expression:"dbObj.dashborad_name"}})],1)],1)],1),a("el-row",[a("el-col",{attrs:{span:20}},[a("el-form-item",{attrs:{label:t.$t("dashboard.dashboardDesc"),prop:"dashborad_desc"}},[a("el-input",{staticStyle:{width:"450px"},attrs:{type:"textarea",rows:5,size:"small",placeholder:t.$t("dashboard.dashboardDescPlaceholder")},model:{value:t.dbObj.dashborad_desc,callback:function(e){t.$set(t.dbObj,"dashborad_desc",e)},expression:"dbObj.dashborad_desc"}})],1)],1)],1),a("el-row",[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:t.$t("dashboard.isPublic"),prop:"is_public"}},[a("el-checkbox",{attrs:{label:!1},model:{value:t.dbObj.is_public,callback:function(e){t.$set(t.dbObj,"is_public",e)},expression:"dbObj.is_public"}},[t._v(t._s(t.$t("dashboard.public")))])],1)],1)],1)],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary",size:"small"},on:{click:t.handleSubmit}},[t._v(t._s(t.$t("common.confirm")))]),a("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(e){t.editDialogVisible=!1}}},[t._v(t._s(t.$t("common.cancel")))])],1)],1)],1)},r=[],i=(a("7514"),a("20d6"),a("ac6a"),a("1980")),o=a.n(i),s=a("ce25"),c=a("5fd4"),d=a("ca17"),l=a.n(d),u=(a("542c"),{name:"dashboard",components:{dashboardItem:s["a"],draggable:o.a,Treeselect:l.a},data:function(){return{activeName:"second",dashboardList:[],publicTreeOptions:void 0,myTreeOptions:void 0,currentDashboard:void 0,editDialogVisible:!1,dbObj:{},loading:!1,isCollapse:!1,project_id:void 0,isShare:!1,defaultProps:{children:"children",label:"label"},rules:{dashborad_name:[{required:!0,message:"概览名称不能为空",trigger:"blur"}]}}},created:function(){this.project_id=this.$route.query.project_id,this.publicDashboardList(),this.myDashboardList(),this.getList()},methods:{publicDashboardList:function(){var t=this;this.loading=!0,Object(c["k"])(this.project_id).then((function(e){t.publicTreeOptions=e.data,t.loading=!1}))},myDashboardList:function(){var t=this;this.loading=!0,Object(c["j"])(this.project_id).then((function(e){t.myTreeOptions=e.data,t.loading=!1,t.dashboardList=e.data[0].children;var a=t.dashboardList[0];t.currentDashboard=a||t.dashboardList[0],Object(c["i"])(t.currentDashboard.id).then((function(e){t.currentDashboard=e.data})),t.currentDashboard&&t.$router.push("/dashboard?id=".concat(t.currentDashboard.id,"&project_id=").concat(t.project_id))}))},handleNodeClick:function(t){var e=this;t.id;1==t.isChild&&(t.isShare?this.isShare=!0:this.isShare=!1,Object(c["i"])(t.id).then((function(t){e.currentDashboard=t.data})),this.$router.push("/dashboard?id=".concat(this.currentDashboard.id,"&project_id=").concat(this.project_id)))},getList:function(){var t=this;this.loading=!0,Object(c["d"])(this.project_id).then((function(e){t.loading=!1,t.dashboardList=[],e.data.order.forEach((function(a,n){var r=e.data.dashboards.findIndex((function(t){return t.dashboard_id===a}));r>=0?(t.dashboardList.push(e.data.dashboards[r]),e.data.dashboards.splice(r,1)):console.log(a,n)})),t.dashboardList=t.dashboardList.concat(e.data.dashboards);var a=t.dashboardList.find((function(e){return e.dashboard_id===t.$route.query.id}));t.currentDashboard=a||t.dashboardList[0],t.currentDashboard&&t.$router.push("/dashboard?id=".concat(t.currentDashboard.dashboard_id,"&project_id=").concat(t.project_id))})).catch((function(t){console.log(t),this.loading=!1}))},addDashboard:function(){this.dbObj={},this.dbObj.private_status=1,this.dbObj.is_public=!1,this.editDialogVisible=!0},editDashboard:function(t){this.dbObj=this.currentDashboard,this.editDialogVisible=!0},handleCommand:function(t){"edit"===t.type?this.editDashboard(t.target):this.deleteDashboard(t.target)},handleSubmit:function(){var t=this;this.dbObj.project_id=this.project_id,void 0!=this.project_id?this.dbObj.dashboard_id?Object(c["n"])(this.dbObj).then((function(e){403!==e.code?(t.myDashboardList(),t.editDialogVisible=!1):t.msgError(e.msg)})):this.$refs["dbObj"].validate((function(e){e&&Object(c["b"])(t.dbObj).then((function(e){t.myDashboardList(),t.editDialogVisible=!1}))})):this.$message({type:"error",message:this.$t("common.firstAddProject")})},handleOrderChange:function(t){var e=this.dashboardList.map((function(t,e){return{dashboard_id:t.dashboard_id}}));Object(c["f"])(e)},deleteDashboard:function(){var t=this;this.$confirm("确定要删除["+this.currentDashboard.dashborad_name+"]概览吗？将同时删除该概览的分享","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){Object(c["g"])({dashboardId:t.currentDashboard.dashboard_id}).then((function(e){403!==e.code?(t.myDashboardList(),t.$message({type:"success",message:t.$t("common.deleteSuccess")})):t.msgError(e.msg)}))}))}}}),h=u,m=(a("5324"),a("2877")),f=Object(m["a"])(h,n,r,!1,null,"e2999176",null);e["default"]=f.exports},ce25:function(t,e,a){"use strict";var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"dashboard-wrapper"},[a("div",{staticClass:"tool-bar"},[a("div",[a("span",{staticClass:"db-name"},[t._v(t._s(t.dashboard.dashborad_name))]),a("span",[t._v(t._s(t.dashboard.dashborad_desc))])]),a("div",{directives:[{name:"show",rawName:"v-show",value:"edit"===t.mode,expression:"mode === 'edit'"}]},[a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:t.handleShare}},[t._v(t._s(t.$t("common.share")))]),a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:t.handleLinkChart}},[t._v(t._s(t.$t("dashboard.addChart")))])],1)]),0!==t.charts.length?a("grid-layout",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticStyle:{"min-height":"500px"},attrs:{layout:t.layout||[],"col-num":24,"row-height":30,"is-draggable":"edit"===t.mode,"is-resizable":"edit"===t.mode,"is-mirrored":!1,"vertical-compact":!0,"pane-container":!1,margin:[10,10],"use-css-transforms":!0},on:{"layout-updated":t.handleLayoutChange}},t._l(t.layout||[],(function(e,n){return a("grid-item",{key:e.index,attrs:{x:e.x,y:e.y,w:e.w,h:e.h,i:e.i},on:{resized:t.handleResize}},[a("el-card",{directives:[{name:"loading",rawName:"v-loading",value:t.chartLoading[e.i],expression:"chartLoading[item.i]"}],staticClass:"visualize-card",attrs:{"body-style":"padding: 10px;"}},[a("div",{staticClass:"operation-bar",attrs:{slot:"header"},slot:"header"},[a("div",{directives:[{name:"show",rawName:"v-show",value:"edit"===t.mode,expression:"mode === 'edit'"}]},[a("a",{attrs:{href:"#"},on:{click:function(a){t.handleEdit(t.getChartItem(e.i))}}},[t._v(t._s(t.getChartItem(e.i).chart_name))])]),a("div",{directives:[{name:"show",rawName:"v-show",value:"view"===t.mode,expression:"mode === 'view'"}]},[a("a",{attrs:{href:"#"}},[t._v(t._s(t.getChartItem(e.i).chart_name))])]),a("div",[a("i",{directives:[{name:"show",rawName:"v-show",value:"edit"===t.mode,expression:"mode === 'edit'"}],staticClass:"el-icon-edit",on:{click:function(a){t.handleEdit(t.getChartItem(e.i))}}}),a("el-dropdown",{attrs:{trigger:"click"}},[a("span",{staticClass:"el-dropdown-link"},[a("i",{staticClass:"el-icon-caret-bottom",attrs:{title:t.$t("common.downdrill")}})]),a("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},t._l(t.getChartItem(e.i).fields,(function(r){return a("el-dropdown-item",{key:r.index,nativeOn:{click:function(a){t.downdrill(t.getChartItem(e.i),r,n)}}},[t._v(t._s(r.field_cname))])})),1)],1),a("i",{directives:[{name:"show",rawName:"v-show",value:"edit"===t.mode,expression:"mode === 'edit'"}],staticClass:"el-icon-delete",on:{click:function(a){t.handleDelete(t.getChartItem(e.i))}}}),a("el-tooltip",{staticClass:"item",attrs:{content:t.getChartItem(e.i).chart_desc,effect:"dark",placement:"top-end"}},[a("i",{staticClass:"el-icon-info",staticStyle:{color:"#409eff",cursor:"pointer"}})])],1)]),a("visualize-panel",{key:e.index,ref:"chartInstance"+e.i,refInFor:!0,attrs:{data:t.results[e.i],schema:t.getChartItem(e.i).content.allSelected,"chart-type":t.getChartItem(e.i).content.chartType,"is-edit-mode":!1,"chart-style":{height:30*e.h+10*(e.h-1)-60+"px"}},on:{"update:chartType":function(a){t.$set(t.getChartItem(e.i).content,"chartType",a)},"update:chart-type":function(a){t.$set(t.getChartItem(e.i).content,"chartType",a)}}})],1)],1)})),1):t._e(),0===t.charts.length&&"edit"===t.mode?a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"welcome-container"},[a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:t.handleLinkChart}},[t._v(t._s(t.$t("dashboard.addChart")))]),a("div",[a("el-link",{attrs:{type:"info",underline:!1}},[a("router-link",{attrs:{to:"/chartpanel/create"}},[t._v(t._s(t.$t("dashboard.emptyDashboardTip")))])],1)],1)],1):t._e(),a("el-dialog",{attrs:{title:t.$t("chart.myChart"),visible:t.showChartList},on:{"update:visible":function(e){t.showChartList=e}}},[a("div",[a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(e){return t.$router.push("/chartpanel/create")}}},[t._v(t._s(t.$t("chart.createNewChart")))]),a("el-table",{attrs:{data:t.myChartList}},[a("el-table-column",{attrs:{label:t.$t("common.name"),width:"200",prop:"chart_name"}}),a("el-table-column",{attrs:{label:t.$t("common.desc"),prop:"desc"}}),a("el-table-column",{attrs:{label:t.$t("common.operation"),align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{size:"mini",type:"primary",disabled:t.isExisted(e.row)},on:{click:function(a){return t.linkChart(e.row)}}},[t._v(t._s(t.$t("common.add")))]),a("el-button",{attrs:{size:"mini",type:"warning"},on:{click:function(a){return t.$router.push("/chartpanel/"+e.row.chart_id)}}},[t._v(t._s(t.$t("common.edit")))])]}}])})],1),a("pagination",{directives:[{name:"show",rawName:"v-show",value:t.total>0,expression:"total>0"}],attrs:{total:t.total,page:t.queryParams.pageNum,limit:t.queryParams.pageSize},on:{"update:page":function(e){return t.$set(t.queryParams,"pageNum",e)},"update:limit":function(e){return t.$set(t.queryParams,"pageSize",e)},pagination:t.handleLinkChart}}),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(e){t.showChartList=!1}}},[t._v(t._s(t.$t("common.close")))])],1)],1)]),a("el-dialog",{attrs:{title:t.sharetitle,visible:t.shareopen,"append-to-body":""},on:{"update:visible":function(e){t.shareopen=e}}},[a("el-form",{ref:"shareform",attrs:{model:t.shareform,"label-width":"120px"}},[a("el-form-item",{attrs:{label:"选择人员",prop:"userids"}},[a("el-select",{attrs:{multiple:"","collapse-tags":"",placeholder:"请选择要分享的人员"},model:{value:t.shareform.userids,callback:function(e){t.$set(t.shareform,"userids",e)},expression:"shareform.userids"}},t._l(t.useroptions,(function(t){return a("el-option",{key:t.userId,attrs:{label:t.nickName,value:t.userId}})})),1)],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},on:{click:t.submitShareForm}},[t._v("确 定")]),a("el-button",{on:{click:t.sharecancel}},[t._v("取 消")])],1)],1)],1)},r=[],i=(a("5df3"),a("20d6"),a("7514"),a("ac6a"),a("ade3")),o=a("7be8"),s=a("edf6"),c=a("f77d"),d=a("5fd4"),l=(a("b414"),a("c638")),u=a("a5e0");function h(t,e){var a={x:t[0][0],y:t[0][1]},n={x:t[1][0],y:t[1][1]},r={x:e[0][0],y:e[0][1]},i={x:e[1][0],y:e[1][1]};return a.y===r.y&&n.y===i.y&&(a.x>=r.x&&a.x<=i.x)}var m={components:{GridLayout:o["GridLayout"],GridItem:o["GridItem"],visualizePanel:s["a"]},props:{dashboard:{required:!1,type:Object,default:function(){return{}}},mode:{required:!1,type:String,default:"view"}},data:function(){return Object(i["a"])(Object(i["a"])(Object(i["a"])(Object(i["a"])({charts:[],results:{},loading:!1,layout:[],myChartList:[],showChartList:!1,chartLoading:{},useroptions:[],shareopen:!1,sharetitle:"",shareform:[],fieldList:[]},"loading",!0),"isshow",!1),"total",0),"queryParams",{pageNum:1,pageSize:10,sourceId:void 0,tableName:void 0})},watch:{"dashboard.dashboard_id":{immediate:!0,handler:function(t){t&&this.getList(t)}}},methods:{sharecancel:function(){this.shareopen=!1,this.reset()},reset:function(){this.shareform={userids:void 0,dashboard_id:void 0},this.resetForm("shareform")},handleShare:function(){var t=this;Object(d["h"])(this.queryParams).then((function(e){t.useroptions=e.rows})),this.reset(),this.shareopen=!0,this.sharetitle="数据概览分享",this.shareform.dashboard_id=this.dashboard.dashboard_id},submitShareForm:function(){var t=this,e=this.shareform.userids.join(",");if(this.shareform.userids=e,this.shareform.dashboard_id=this.dashboard.dashboard_id,void 0==this.dashboard.dashboard_id||""==e)return this.msgError("分享失败"),void(this.shareopen=!1);Object(d["l"])(this.shareform).then((function(e){200===e.code&&(t.msgSuccess("分享成功"),t.shareopen=!1)}))},getList:function(){var t=this;this.charts=[],this.layout=[],this.loading=!0,Object(d["c"])(this.dashboard.dashboard_id).then((function(e){t.loading=!1,t.charts=e.data||[];var a=[],n=t.dashboard.content||[];t.charts.forEach((function(e,r){t.$set(t.results,e.chart_id,[]),t.$set(t.chartLoading,e.chart_id,!1),e.content=e.content,e.content.allSelected=[],e.content.allSelected=e.content.allSelected.concat(e.content.selectedCalcul).concat(e.content.selectedDimension),e.content.filters&&(a=e.content.filters.map(u["a"]));var i=Object(u["b"])({dataSrc:e.content.dataSrc,selectedCalcul:e.content.selectedCalcul,selectedDimension:e.content.selectedDimension,orderByStrs:e.content.orderByStrs,filterStr:a.join(" and "),limit:e.content.limit});t.exeSql(i,e,r),n.find((function(t){return t.id===e.chart_id}))||t.generatePosition(e,n,r)})),t.layout=n.filter((function(e){return t.charts.find((function(t){return t.chart_id===e.id}))})),t.handleLayoutChange()}))},getChartItem:function(t){return this.charts.find((function(e){return e.chart_id===t}))},handleCaculPos:function(t){var e=[];return t.forEach((function(t){t.yOffSet=t.y+t.h,t.xOffSet=t.x+t.w,t.bottomLine=[[t.x,t.yOffSet],[t.xOffSet,t.yOffSet]],t.topLine=[[t.x,t.y],[t.xOffSet,t.y]]})),t.forEach((function(a){var n=t.every((function(t){return!h(a.bottomLine,t.topLine)}));n&&e.push(a)})),e},generatePosition:function(t,e,a){var n;if(0===e.length)n={id:t.chart_id,x:0,y:0,w:12,h:9,i:t.chart_id};else{var r=this.handleCaculPos(e),i=r.reduce((function(t,e){return t.bottomLine[0][1]>e.bottomLine[0][1]&&(t=e),t}),r[0]);n={id:t.chart_id,x:i.x,y:i.yOffSet,w:i.w,h:9,i:t.chart_id}}e.push(n)},handleLinkChart:function(){var t=this;this.loading=!0,Object(l["a"])(this.addDateRange(this.queryParams,this.dateRange)).then((function(e){t.myChartList=e.rows,t.showChartList=!0,t.total=e.total,t.loading=!1}))},linkChart:function(t){var e=this,a={chartId:t.chart_id,dashboardId:this.dashboard.dashboard_id};void 0!=this.dashboard.dashboard_id?Object(d["a"])(a).then((function(t){e.showChartList=!1,e.getList(),e.$message({type:"success",message:e.$t("common.saveSuccess")})})):this.$message({type:"error",message:"请先创建看板,然后添加图表"})},isExisted:function(t){return this.charts.findIndex((function(e){return e.chart_id===t.chart_id}))>=0},handleCommand:function(t){t.content.dataSrc,t.source_id},downdrill:function(t,e,a){var n=[],r=this.dashboard.content||[],i={Type:e.field_type,asxAxis:!0,isDimension:!0,Column:e.field_name,cname:e.field_cname,name:e.field_name,lable:e.field_cname,id:e.field_id};t.content.filters&&(n=t.content.filters.map(u["a"]));var o=Object(u["b"])({dataSrc:t.content.dataSrc,selectedCalcul:t.content.selectedCalcul,selectedDimension:i,orderByStrs:t.content.orderByStrs,filterStr:n.join(" and "),limit:t.content.limit});t.content.selectedDimension=i,t.content.allSelected=[],t.content.allSelected=t.content.allSelected.concat(t.content.selectedCalcul).concat(t.content.selectedDimension),t.content.selectedDimension=i,this.exeSql(o,t,a),r.find((function(e){return e.id===t.chart_id}))||this.generatePosition(t,r,a)},handleEdit:function(t){this.$router.push("/chartpanel/".concat(t.chart_id))},handleDelete:function(t){var e=this;this.$confirm(this.$t("dashboard.removeChartConfirm"),this.$t("common.confirm"),{type:"warning"}).then((function(){var a=e.layout.findIndex((function(e){return e.id===t.chart_id})),n=e.layout;n.splice(a,1),e.dashboard.content.layout=n;var r={chartId:t.chart_id,dashboardId:e.dashboard.dashboard_id};Promise.all([Object(d["n"])(e.dashboard),Object(d["m"])(r)]).then((function(t){403!==t.code?(e.getList(),e.$message({type:"success",message:e.$t("common.deleteSuccess")})):e.msgError(t.msg)}))}))},handleLayoutChange:function(){"view"!==this.mode&&(this.dashboard.content=this.layout||{},this.dashboard.content.layout=this.layout,Object(d["n"])(this.dashboard))},handleResize:function(t,e,a,n,r){this.$refs["chartInstance".concat(t)][0].$children[0].$emit("resized")},exeSql:function(t,e,a){var n=this;if(this.$set(this.chartLoading,e.chart_id,!0),!t)return this.$message.warning(this.$t("dashboard.chartQueryException",e.chart_name)),void this.$set(this.chartLoading,e.chart_id,!1);Object(c["b"])({source_id:e.source_id,sql:t}).then((function(t){n.$set(n.chartLoading,e.chart_id,!1),n.$set(n.results,e.chart_id,t.data)})).catch((function(){n.$set(n.chartLoading,e.chart_id,!1)}))}}},f=m,p=(a("2dec"),a("2877")),b=Object(p["a"])(f,n,r,!1,null,"57235442",null);e["a"]=b.exports},e2636:function(t,e,a){},e380:function(t,e,a){"use strict";a("bdaf")},edf6:function(t,e,a){"use strict";var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"pane-container"},[a(t.currentType.componentName,{tag:"component",staticClass:"visualize-window",attrs:{data:t.chartData,schema:t.schema,"chart-style":t.chartStyle}}),t.isEditMode?a("div",{staticClass:"chart-style-panel"},[a("el-form",{attrs:{"label-position":"top",size:"mini"}},[a("el-form-item",{attrs:{label:t.$t("chart.chartType")+":"}},[a("div",{staticClass:"chart-type-list"},t._l(t.chartTypeList,(function(e){return a("span",{key:e.type,class:{activedIcon:e.type===t.chartType,disabledIcon:!t.isUsable(e)},on:{click:function(a){return t.switchChartType(e)}}},[a("el-tooltip",{attrs:{content:e.name+": "+e.matchRule.desc,placement:"top"}},[t._v("\n              "+t._s(t.isUsable(e)?e.icon:e.icon+"_disabled")+"\n              "),a("svg-icon",{staticClass:"icon",attrs:{"icon-class":t.isUsable(e)?e.icon:e.icon+"_disabled"}})],1)],1)})),0)])],1)],1):t._e()],1)},r=[],i=(a("7514"),function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{ref:"chart",style:t.chartStyle})}),o=[],s=(a("8615"),a("7f7f"),a("6762"),a("ac6a"),a("4f7f"),a("5df3"),a("1c4c"),a("313e")),c=a.n(s);function d(t){return t/1e3>=.1&&t/1e4<1?t/1e3+"k":t/1e4>=1?t/1e4+"w":t}a("817d");var l={props:{widgetMeta:{required:!1,type:Object,default:function(){}},data:{required:!0,default:function(){}},schema:{type:Array,required:!0},chartOpt:{type:Object,required:!1},chartStyle:{require:!1,type:Object,default:function(){return{height:"500px"}}}},data:function(){return{chart:null}},watch:{data:{deep:!0,handler:function(t){this.renderChart(t)}},schema:{deep:!0,handler:function(){this.renderChart(this.data)}}},mounted:function(){this.renderChart(this.data),this.$on("resized",this.handleResize),window.addEventListener("resize",this.handleResize)},beforeDestroy:function(){this.chart&&this.chart.dispose(),window.removeEventListener("resize",this.handleResize)},methods:{handleResize:function(){this.chart&&this.chart.resize()},renderChart:function(t){var e=this;if(this.$refs.chart){var a=[],n=[],r={},i=this.schema.filter((function(t){return t.asxAxis})),o=this.schema.filter((function(t){return!t.asxAxis}))[0];2===i.length?(a=Array.from(new Set(t.map((function(t){return t[i[1].cname]})))),a.forEach((function(t){r[t]={name:t,data:[],type:"line"}})),t.forEach((function(t){n.includes(t[i[0].name])||n.push(t[i[0].name])})),n.forEach((function(e,n){a.forEach((function(a){var s=t.find((function(t){return t[i[0].name]===e&&t[i[1].name]===a}));r[a].data[n]=s?s[o.name]:void 0}))}))):this.schema.forEach((function(e,i){a.push(e.lable||e.name),e.asxAxis||(r[e.name]={name:e.lable||e.name,data:[],type:"line"}),t.forEach((function(t){e.asxAxis&&!n.includes(t[e.name])?n.push(t[e.name]):r[e.name].data.push(t[e.name])}))}));var s={legend:{bottom:0,type:"scroll",data:a},toolbox:{show:!0,itemSize:12,top:0,feature:{saveAsImage:{show:!0},magicType:{type:["line","bar"]},restore:{show:!0},dataZoom:{show:!0}}},grid:{top:"10px",left:"45px",right:"0",bottom:"45px"},tooltip:{trigger:"axis",axisPointer:{type:"cross"}},xAxis:{type:"category",axisLabel:{color:"#95a4bd"},axisLine:{lineStyle:{color:"#95a4bd"}},data:n},yAxis:{axisLabel:{show:!0,color:"#95a4bd",formatter:d},axisLine:{lineStyle:{color:"#95a4bd"}},splitLine:{lineStyle:{type:"dashed"}}},series:Object.values(r)};setTimeout((function(){e.chart||(e.chart=c.a.init(e.$refs.chart,"macarons")),e.chart.clear(),e.chart.setOption(s),e.chartOpt&&e.chart.setOption(e.chartOpt)}),0)}}}},u=l,h=a("2877"),m=Object(h["a"])(u,i,o,!1,null,null,null),f=m.exports,p=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-table",{style:t.chartStyle,attrs:{data:t.data,height:t.chartStyle.height,"highlight-current-row":"",border:"",stripe:"","header-cell-style":{padding:"5px 0"},"cell-style":{padding:"5px 0"}}},t._l(t.schema,(function(t){return a("el-table-column",{key:t.Column,attrs:{sortable:"",prop:t.Column,label:t.cname,align:"center"}})})),1)},b=[],g={props:{data:{type:Array,default:function(){return[]}},schema:{type:Array,default:function(){return[]}},chartStyle:{require:!1,type:Object,default:function(){return{height:"500px"}}}}},y=g,v=Object(h["a"])(y,p,b,!1,null,null,null),x=v.exports,O=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{ref:"chart",style:t.chartStyle})},w=[];a("817d");var C={props:{data:{required:!0,default:function(){}},schema:{type:Array,required:!0},chartOpt:{type:Object,required:!1},chartStyle:{require:!1,type:Object,default:function(){return{height:"500px"}}}},data:function(){return{chart:null}},watch:{data:{deep:!0,handler:function(t){this.renderChart(t)}},schema:{deep:!0,handler:function(){this.renderChart(this.data)}}},mounted:function(){this.renderChart(this.data),this.$on("resized",this.handleResize),window.addEventListener("resize",this.handleResize)},beforeDestroy:function(){this.chart&&this.chart.dispose(),window.removeEventListener("resize",this.handleResize)},methods:{handleResize:function(){this.chart&&this.chart.resize()},renderChart:function(t){var e=this;if(this.$refs.chart){var a=[],n=[],r={};if(2===this.schema.filter((function(t){return t.asxAxis})).length){var i=this.schema.filter((function(t){return t.asxAxis})),o=i[0].name,s=i[1].name,l=this.schema.find((function(t){return!t.asxAxis})).name;n=this.data.map((function(t){return a.push(t[s]),t[o]})),n=Array.from(new Set(n)),a=Array.from(new Set(a)),a=a.map((function(e,a){var i=n.map((function(a){var n=t.find((function(t){return t[s]===e&&t[o]===a}));return n?n[l]:"-"}));return e+="",r[e]={name:e,data:i,type:"bar"},e}))}else this.schema.forEach((function(e,i){a.push(e.lable||e.cname),e.asxAxis||(r[e.name]={name:e.lable||e.name,data:[],type:"bar"}),t.forEach((function(t){e.asxAxis?n.push(t[e.name]):r[e.name].data.push(t[e.name])}))}));var u={legend:{bottom:0,type:"scroll",data:a},toolbox:{show:!0,top:0,itemSize:12,feature:{saveAsImage:{show:!0},magicType:{type:["line","bar"]},restore:{show:!0},dataZoom:{show:!0}}},grid:{top:"10px",left:"45px",right:"0",bottom:"45px"},tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},xAxis:{type:"category",axisLabel:{color:"#95a4bd"},axisLine:{lineStyle:{color:"#95a4bd"}},splitArea:{show:!0,interval:0},data:n},yAxis:{axisLabel:{show:!0,color:"#95a4bd",formatter:d},axisLine:{lineStyle:{color:"#95a4bd"}},splitLine:{lineStyle:{type:"dashed"}}},series:Object.values(r)};setTimeout((function(){e.chart||(e.chart=c.a.init(e.$refs.chart,"macarons")),e.chart.clear(),e.chart.setOption(u),e.chartOpt&&e.chart.setOption(e.chartOpt)}),0)}}}},_=C,j=Object(h["a"])(_,O,w,!1,null,null,null),S=j.exports,z=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{ref:"chart",style:t.chartStyle})},L=[];a("817d");var $={props:{data:{required:!0,default:function(){}},schema:{type:Array,required:!0},chartOpt:{type:Object,required:!1},chartStyle:{require:!1,type:Object,default:function(){return{height:"500px"}}}},data:function(){return{chart:null}},watch:{data:{deep:!0,handler:function(t){this.renderChart(t)}},schema:{deep:!0,handler:function(){this.renderChart(this.data)}}},mounted:function(){this.renderChart(this.data),this.$on("resized",this.handleResize),window.addEventListener("resize",this.handleResize)},beforeDestroy:function(){this.chart&&this.chart.dispose(),window.removeEventListener("resize",this.handleResize)},methods:{handleResize:function(){this.chart&&this.chart.resize()},renderChart:function(t){var e=this;if(this.$refs.chart){var a=[],n=[],r={};this.schema.forEach((function(e,i){a.push(e.label||e.cname),e.asxAxis||(r[e.name]={name:e.lable||e.cname,data:[],stack:"All",type:"bar"}),t.forEach((function(t){e.asxAxis?n.push(t[e.name]):r[e.name].data.push(t[e.name])}))}));var i={legend:{type:"scroll",data:a,bottom:0},toolbox:{show:!0,top:0,itemSize:12,feature:{saveAsImage:{show:!0},magicType:{type:["line","bar"]},restore:{show:!0},dataZoom:{show:!0}}},grid:{top:"10px",left:"45px",right:"0",bottom:"45px"},tooltip:{trigger:"axis",axisPointer:{type:"cross"}},xAxis:{type:"category",axisLabel:{color:"#95a4bd"},axisLine:{lineStyle:{color:"#95a4bd"}},data:n},yAxis:{axisLabel:{show:!0,color:"#95a4bd",formatter:d},axisLine:{lineStyle:{color:"#95a4bd"}},splitLine:{lineStyle:{type:"dashed"}}},series:Object.values(r)};setTimeout((function(){e.chart||(e.chart=c.a.init(e.$refs.chart,"macarons")),e.chart.clear(),e.chart.setOption(i),e.chartOpt&&e.chart.setOption(e.chartOpt)}),0)}}}},T=$,D=Object(h["a"])(T,z,L,!1,null,null,null),k=D.exports,A=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{ref:"chart",style:t.chartStyle})},E=[];a("817d");var q={props:{widgetMeta:{required:!1,type:Object,default:function(){}},data:{required:!0,default:function(){}},schema:{type:Array,required:!0},chartOpt:{type:Object,required:!1},chartStyle:{require:!1,type:Object,default:function(){return{height:"500px"}}}},data:function(){return{chart:null}},watch:{data:{deep:!0,handler:function(t){this.renderChart(t)}},schema:{deep:!0,handler:function(){this.renderChart(this.data)}}},mounted:function(){this.renderChart(this.data),this.$on("resized",this.handleResize),window.addEventListener("resize",this.handleResize)},beforeDestroy:function(){this.chart&&this.chart.dispose(),window.removeEventListener("resize",this.handleResize)},methods:{handleResize:function(){this.chart&&this.chart.resize()},renderChart:function(t){var e=this;if(this.$refs.chart){if(0===t.length&&this.chart)return this.chart.clear(),void this.chart.setOption({graphic:[{type:"group",left:"center",top:"center",children:[{type:"text",z:100,left:"center",top:"middle",style:{fill:"#333",text:this.noDataDesc,font:"14px Microsoft YaHei"}}]}]});var a=[],n=[],r={};if(2===this.schema.filter((function(t){return t.asxAxis})).length){var i=this.schema.filter((function(t){return t.asxAxis})),o=i[0].name,s=i[1].lable,d=this.schema.find((function(t){return!t.asxAxis})).name;n=this.data.map((function(t){return a.push(t[s]),t[o]})),n=Array.from(new Set(n)),a=Array.from(new Set(a)),a=a.map((function(e,a){var i=n.map((function(a){var n=t.find((function(t){return t[s]===e&&t[o]===a}));return n?n[d]:"-"}));return e+="",r[e]={name:e,data:i,type:"bar"},e}))}else this.schema.forEach((function(e,i){a.push(e.lable||e.name),e.asxAxis||(r[e.name]={name:e.lable||e.name,data:[],type:"bar"}),t.forEach((function(t){e.asxAxis?n.push(t[e.name]):r[e.name].data.push(t[e.name])}))}));var l={legend:{bottom:0,type:"scroll",data:a},toolbox:{show:!0,feature:{saveAsImage:{show:!0},restore:{show:!0},dataZoom:{show:!1}}},grid:{top:"10%",left:"80px",bottom:"10%",right:"20px"},tooltip:{trigger:"axis",axisPointer:{type:"cross"}},xAxis:{type:"value",axisLabel:{color:"#95a4bd"},axisLine:{lineStyle:{color:"#95a4bd"}}},yAxis:{type:"category",data:n,axisLabel:{show:!0,color:"#95a4bd"},axisLine:{lineStyle:{color:"#95a4bd"}},splitLine:{lineStyle:{type:"dashed"}}},series:Object.values(r)};setTimeout((function(){e.chart||(e.chart=c.a.init(e.$refs.chart,"macarons")),e.chart.clear(),e.chart.setOption(l),e.chartOpt&&e.chart.setOption(e.chartOpt)}),0)}}}},I=q,R=Object(h["a"])(I,A,E,!1,null,null,null),N=R.exports,F=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{ref:"chart",style:t.chartStyle})},P=[];a("817d");var B={props:{data:{required:!0,default:function(){}},schema:{type:Array,required:!0},chartOpt:{type:Object,required:!1},chartStyle:{require:!1,type:Object,default:function(){return{height:"500px"}}}},data:function(){return{chart:null}},watch:{data:{deep:!0,handler:function(t){this.renderChart(t)}},schema:{deep:!0,handler:function(){this.renderChart(this.data)}}},mounted:function(){this.renderChart(this.data),this.$on("resized",this.handleResize),window.addEventListener("resize",this.handleResize)},beforeDestroy:function(){this.chart&&this.chart.dispose(),window.removeEventListener("resize",this.handleResize)},methods:{handleResize:function(){this.chart&&this.chart.resize()},renderChart:function(t){var e=this;if(this.$refs.chart&&t[0]){var a=[],n={};0===this.schema.filter((function(t){return t.asxAxis})).length?(n={name:"",type:"pie",radius:"55%",center:["50%","60%"],data:[],tooltip:{formatter:function(t){return"".concat(t.name,": ").concat(t.percent,"%")}},itemStyle:{emphasis:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}},t=t[0],this.schema.forEach((function(e,r){a.push(e.lable),n.data[r]=n.data[r]||{},n.data[r].name=e.name,n.data[r].value=t[e.name]}))):(n={name:"",type:"pie",radius:"55%",center:["50%","40%"],data:[],tooltip:{formatter:function(t){return"".concat(t.name,": ").concat(t.percent,"%")}},itemStyle:{emphasis:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}},this.schema.forEach((function(e,r){t.forEach((function(t,r){n.data[r]=n.data[r]||{},e.asxAxis?(a.push(t[e.name]),n.data[r].name=t[e.name]):n.data[r].value=t[e.name]}))})));var r={legend:{type:"scroll",data:a,bottom:0},toolbox:{show:!0,itemSize:12,feature:{saveAsImage:{show:!0},magicType:{type:["line","bar"]},restore:{show:!0},dataZoom:{show:!0}}},grid:{top:"10px",left:"80px",right:"0",bottom:"45px"},tooltip:{trigger:"item"},series:[n]};setTimeout((function(){e.chart||(e.chart=c.a.init(e.$refs.chart,"macarons")),e.chart.clear(),e.chart.setOption(r),e.chartOpt&&e.chart.setOption(e.chartOpt)}),0)}}}},Q=B,V=Object(h["a"])(Q,F,P,!1,null,null,null),U=V.exports,M=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{style:t.chartStyle},[a("div",{staticStyle:{"vertical-align":"middle","text-align":"center",display:"table-cell"}},[a("span",{staticStyle:{color:"#rgb(228, 11, 11)",fontSize:"35px"}},[t._v(t._s(t.numberValue))])])])},G=[];a("a481");a("817d");var Z={props:{data:{required:!0,numberValue:void 0,default:function(){}},schema:{type:Array,required:!0},chartOpt:{type:Object,required:!1},chartStyle:{require:!1,type:Object,default:function(){return{height:"500px"}}}},data:function(){return{chart:null,list:[],title:"",numberValue:void 0}},watch:{data:{deep:!0,numberValue:void 0,handler:function(t){this.renderChart(t)}},schema:{deep:!0,handler:function(){this.renderChart(this.data)}}},mounted:function(){this.renderChart(this.data),this.$on("resized",this.handleResize),window.addEventListener("resize",this.handleResize)},beforeDestroy:function(){this.chart&&this.chart.dispose(),window.removeEventListener("resize",this.handleResize)},methods:{handleResize:function(){this.chart&&this.chart.resize()},renderChart:function(t){if(t[0]){var e=t[0],a=this.schema[0].Column;this.title=this.schema[0].lable;var n=e[a]+"";this.numberValue=n.replace(/\d{1,3}(?=(\d{3})+(\.\d*)?$)/g,"$&,")}}}},H=Z,Y=(a("943b"),Object(h["a"])(H,M,G,!1,null,"ea0ea7a8",null)),X=Y.exports,J=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{ref:"myEchart",style:t.chartStyle,attrs:{id:"map"}})},W=[],K=a("53ca");a("3139"),a("bc3a");a("817d");var tt={props:{widgetMeta:{required:!1,type:Object,default:function(){}},data:{required:!0,default:function(){}},schema:{type:Array,required:!0},chartOpt:{type:Object,required:!1},chartStyle:{require:!1,type:Object,default:function(){return{height:"500px"}}}},data:function(){return{provinces:["shanghai","hebei","shanxi","neimenggu","liaoning","jilin","heilongjiang","jiangsu","zhejiang","anhui","fujian","jiangxi","shandong","henan","hubei","hunan","guangdong","guangxi","hainan","sichuan","guizhou","yunnan","xizang","shanxi1","gansu","qinghai","ningxia","xinjiang","beijing","tianjin","chongqing","xianggang","aomen","taiwan"],provincesText:["上海","河北","山西","内蒙古","辽宁","吉林","黑龙江","江苏","浙江","安徽","福建","江西","山东","河南","湖北","湖南","广东","广西","海南","四川","贵州","云南","西藏","陕西","甘肃","青海","宁夏","新疆","北京","天津","重庆","香港","澳门","台湾"],map:{},province:""}},watch:{data:{deep:!0,handler:function(t){var e=this;this.data=t,this.$nextTick((function(){e.renderChart("china")})),this.map&&this.map.resize()}},schema:{deep:!0,handler:function(){this.renderChart("china")}}},mounted:function(){var t=this;this.$nextTick((function(){t.renderChart("china")})),this.$on("resized",this.handleResize),window.addEventListener("resize",this.handleResize)},beforeDestroy:function(){this.map&&this.map.dispose(),window.removeEventListener("resize",this.handleResize)},methods:{handleResize:function(){this.map&&this.map.resize()},getMapOpt:function(t){var e={tooltip:{trigger:"item",formatter:function(t){if(t["data"])return"".concat(t["name"],"</br>").concat(t["data"].label,": (").concat(t["value"],")")},position:"inside"},dataRange:{show:!1,min:0,max:1e3,text:["High","Low"],realtime:!0,calculable:!0,color:["orangered","yellow","lightskyblue"]},geo:{map:t||"china",roam:!0,label:{normal:{show:!0,textStyle:{color:"rgba(0,0,0)"}}},itemStyle:{normal:{borderColor:"rgba(0, 0, 0, 0.2)"},emphasis:{areaColor:null,shadowOffsetX:0,shadowOffsetY:0,shadowBlur:20,borderWidth:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}},series:[{type:"scatter",coordinateSystem:"geo"},{type:"map",geoIndex:0,data:this.data}]};return e},showChinaMap:function(){this.map.dispose(),this.renderChart()},renderChart:function(t){var e=this;if(1===this.schema.filter((function(t){return t.asxAxis})).length){var a=this.schema.filter((function(t){return t.asxAxis})),n=a[0].name,r=this.schema.find((function(t){return!t.asxAxis})).lable,i=this.schema.find((function(t){return!t.asxAxis})).name;this.data.map((function(t){t.name=t[n],t.value=t[i],t.label=r})),this.map=c.a.init(document.getElementById("map"),"macarons"),window.onresize=this.map.resize,this.map.showLoading();var o=this.getMapOpt(t);o&&"object"===Object(K["a"])(o)&&(this.map.setOption(o,!0),setTimeout((function(){e.map.hideLoading()}),500))}else{this.map=c.a.init(document.getElementById("map"),"macarons"),window.onresize=this.map.resize,this.map.showLoading();var s=this.getMapOpt(t);s&&"object"===Object(K["a"])(s)&&(this.map.setOption(s,!0),setTimeout((function(){e.map.hideLoading()}),500))}}}},et=tt,at=(a("e380"),Object(h["a"])(et,J,W,!1,null,null,null)),nt=at.exports,rt=a("9225"),it=a("aa35");function ot(t,e){var a=t.map((function(t){var a={};return e.forEach((function(e){e.calculFunc?e.lable="".concat(e.cname,"(").concat(it["c"][e.calculFunc],")"):e.lable="".concat(e.cname),e.name=e.Column,e.asxAxis=e.isDimension,a[e.Column]=t[e.Column]})),a}));return a}var st=[{name:rt["a"].t("chartType.table"),icon:"chart_table",type:"table",matchRule:{desc:rt["a"].t("chartType.tableDesc"),isUsable:function(t,e){return!0}},componentName:"DataTable",dataTransfer:function(t,e){var a=t.map((function(t){var a={};return e.forEach((function(e){e.calculFunc?e.name="".concat(e.cname,"(").concat(it["c"][e.calculFunc],")"):e.name="".concat(e.cname),a[e.Column]=t[e.Column]})),a}));return a}},{name:rt["a"].t("chartType.line"),icon:"chart_line",type:"line",matchRule:{desc:rt["a"].t("chartType.lineDesc"),isUsable:function(t,e){return(1===t.length||2===t.length)&&e.length>=1}},componentName:"lineChart",dataTransfer:ot},{name:rt["a"].t("chartType.bar"),icon:"chart_bar",type:"bar",matchRule:{desc:rt["a"].t("chartType.barDesc"),isUsable:function(t,e){return(1===t.length||2===t.length)&&e.length>=1}},componentName:"BarChart",dataTransfer:ot},{name:rt["a"].t("chartType.number"),icon:"chart_number",type:"number",matchRule:{desc:rt["a"].t("chartType.numberDesc"),isUsable:function(t,e){return 1==e.length}},componentName:"number",dataTransfer:ot},{name:rt["a"].t("chartType.stackBar"),icon:"stack_bar",type:"stackBar",matchRule:{desc:rt["a"].t("chartType.stackBarDesc"),isUsable:function(t,e){return(1===t.length||2===t.length)&&e.length>=2}},componentName:"StackBarChart",dataTransfer:ot},{name:rt["a"].t("chartType.pie"),icon:"chart_pie",type:"pie",matchRule:{desc:rt["a"].t("chartType.pieDesc"),isUsable:function(t,e){return 1===t.length&&1===e.length||0===t.length&&e.length>=1}},componentName:"PieChart",dataTransfer:ot},{name:rt["a"].t("chartType.horizontalBar"),icon:"horizontal_bar",type:"horizontalBar",matchRule:{desc:rt["a"].t("chartType.horizontalBarDesc"),isUsable:function(t,e){return(1===t.length||2===t.length)&&e.length>=1}},componentName:"HorizontalBar",dataTransfer:ot},{name:rt["a"].t("chartType.map"),icon:"chart_map",type:"mapchina",matchRule:{desc:rt["a"].t("chartType.mapDesc"),isUsable:function(t,e){return 1===t.length&&1==e.length}},componentName:"MapChart",dataTransfer:ot}],ct=st,dt=a("f0ee"),lt={components:{lineChart:f,DataTable:x,BarChart:S,StackBarChart:k,number:X,PieChart:U,HorizontalBar:N,MapChart:nt},props:{data:{type:Array,required:!0},schema:{type:Array,required:!0},chartStyle:{require:!1,type:Object},chartType:{type:String,default:"table"},isEditMode:{type:Boolean,default:!0}},data:function(){return{chartTypeList:ct}},computed:{allSelected:function(){return dt["a"].state.caculCols.concat(dt["a"].state.dimensions)},chartData:function(){return this.currentType.dataTransfer?this.currentType.dataTransfer(this.data,this.schema):this.data},currentType:function(){var t=this;return ct.find((function(e){return e.type===t.chartType}))}},watch:{allSelected:{deep:!0,handler:function(){this.currentType.matchRule.isUsable(dt["a"].state.dimensions,dt["a"].state.caculCols)||this.$emit("update:chartType","table")}}},methods:{isUsable:function(t){return t.matchRule.isUsable(dt["a"].state.dimensions,dt["a"].state.caculCols)},switchChartType:function(t){t.matchRule.isUsable(dt["a"].state.dimensions,dt["a"].state.caculCols)&&this.$emit("update:chartType",t.type)}}},ut=lt,ht=(a("8034"),Object(h["a"])(ut,n,r,!1,null,"6d16fe44",null));e["a"]=ht.exports},f0ee:function(t,e,a){"use strict";a("20d6");var n=a("a5e0"),r=a("aa35"),i={debug:!1,state:{dimensions:[],caculCols:[],allCols:[]},addDimensionAction:function(t){this.debug&&console.log("adddimensionAction triggered with",t),t.isDimension=!0},deleteDimensionAction:function(t){this.debug&&console.log("deleteDimensionAction triggered with",t);var e=this.state.dimensions.findIndex((function(e){return e.Column===t.Column}));this.state.dimensions[e].isDimension=!1,this.state.dimensions.splice(e,1)},setDimensionsAction:function(t){this.debug&&console.log("setDimensionsAction triggered"),this.state.dimensions=t},addCaculColAction:function(t){this.debug&&console.log("addCaculColAction triggered with",t);var e=Object(n["c"])(t.Type),a=this.state.caculCols.findIndex((function(e){return e.Column===t.Column})),i={Column:t.Column,cname:t.cname,calculFunc:e.availableFunc[0],Type:t.Type,availableFunc:e.availableFunc.map((function(t){return{name:r["c"][t],func:t}}))};this.state.caculCols.splice(a,1,i)},deleteCaculColAction:function(t){this.debug&&console.log("deleteCaculColAction triggered with",t);var e=this.state.caculCols.findIndex((function(e){return e.Column===t.Column}));this.state.caculCols.splice(e,1)},setCaculColsAction:function(t){this.debug&&console.log("setCaculColsAction triggered"),this.state.caculCols=t},setAllColsAction:function(t){this.debug&&console.log("setAllColsAction triggered width",t),this.state.allCols=t}};e["a"]=i},f77d:function(t,e,a){"use strict";a.d(e,"b",(function(){return o}));var n=a("b775"),r=a("bc3a"),i=a.n(r);function o(t){return Object(n["a"])({url:"/rest/bi/exec/exec",method:"POST",data:t})}e["a"]=function(){var t=i.a.CancelToken.source();return{cancel:function(){t.cancel("cancel")},fetch:function(t){return Object(n["a"])({url:"/rest/bi/exec/exec",method:"POST",data:t})}}}}}]);